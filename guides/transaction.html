

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sending transactions &mdash; nem2-docs Master documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon-32x32.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/examplecode.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="nem2-docs Master documentation" href="../index.html"/>
        <link rel="next" title="Overview" href="../cli/overview.html"/>
        <link rel="prev" title="Interacting with mosaics" href="mosaic.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo-nem.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.9.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
    <!--<div class="sidebar-links">
        <a href="#">API Reference</a> · <a href="#">SDK References</a>
    </div>-->

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/setup-workstation.html">Setting up your workstation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/first-application.html">Writing your first application</a></li>
</ul>
<p class="caption"><span class="caption-text">Fundamentals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/account.html">Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/multisig-account.html">Multisig Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/transaction.html">Transaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/namespace.html">Namespace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/mosaic.html">Mosaic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/block.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/node.html">Node</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="account.html">Interacting with accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="blockchain.html">Monitoring blockchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="namespace.html">Registering namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="mosaic.html">Interacting with mosaics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sending transactions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sending-a-transfer-transaction">Sending a transfer transaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lets-get-into-some-code">Let’s get into some code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-s-next">What’s next?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sending-a-multisig-transaction">Sending a multisig transaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Let’s get into some code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">What’s next?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sending-payouts-with-aggregate-complete-transaction">Sending payouts with aggregate complete transaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#let-s-get-into-some-code">Let’s get into some code?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">What’s next?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-escrow-with-aggregate-bonded-transaction">Creating an escrow with aggregate bonded transaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Let’s get into some code?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#is-it-possible-without-aggregate-transactions">Is it possible without aggregate transactions?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">What’s next?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#asking-for-mosaics-with-aggregate-bonded-transaction">Asking for mosaics with aggregate bonded transaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Let’s get into some code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">What’s next?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#signing-announced-aggregate-bonded-transactions">Signing announced aggregate bonded transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id15">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">Let’s get into some code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#signing-announced-aggregate-bonded-transactions-automatically">Signing announced aggregate bonded transactions automatically</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id17">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Let’s get into some code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19">What’s next?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-secret-lock-for-atomic-cross-chain-swap-transactions">Using secret lock for atomic cross-chain swap transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id20">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22">Let’s get into some code?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#is-it-atomic">Is it atomic?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">NEM2-CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/commands.html">Commands</a></li>
</ul>
<p class="caption"><span class="caption-text">NEM2-SDK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sdk/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sdk/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sdk/languages.html">Languages &amp; References</a></li>
</ul>
<p class="caption"><span class="caption-text">NIS2-API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/announce-transaction.html">Announcing transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/websockets.html">WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/errors.html">Error Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">NEM2 Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../libraries/overview.html">Extending NEM capabilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support/contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">nem2-docs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Sending transactions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/guides/transaction.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sending-transactions">
<h1>Sending transactions<a class="headerlink" href="#sending-transactions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="sending-a-transfer-transaction">
<span id="guide-sending-a-transfer-transaction"></span><h2>Sending a transfer transaction<a class="headerlink" href="#sending-a-transfer-transaction" title="Permalink to this headline">¶</a></h2>
<p>The goal of this guide is to create a <a class="reference internal" href="../concepts/transaction.html#transfer-transaction"><span class="std std-ref">transfer transaction</span></a>, one of the most commonly used actions in NEM.</p>
<p>Then, you will sign and announce the transaction to the network.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish the <a class="reference internal" href="../getting-started/setup-workstation.html"><span class="doc">getting started section</span></a></li>
<li>NEM2-SDK or CLI</li>
<li>A text editor or IDE</li>
<li>An account with XEM</li>
</ul>
</div>
<div class="section" id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id23">
<a class="reference internal image-reference" href="../_images/guides-transactions-transfer.png"><img alt="../_images/guides-transactions-transfer.png" src="../_images/guides-transactions-transfer.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text">Sending a transfer Transaction</span></p>
</div>
<p>Alice wants to send 10 XEM to Bob, who just created a NEM account with address <code class="docutils literal"><span class="pre">SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54</span></code>.</p>
<p>The transfer transaction is used to send mosaics between two accounts. It can hold a message of length <code class="docutils literal"><span class="pre">1024</span></code>.</p>
<p><strong>Monitoring the transaction</strong></p>
<p>Before starting this example, it is advisable to see what happens when sending transactions to the blockchain.</p>
<p>We suggest opening three new terminals, and type the following commands:</p>
<p>The first terminal <a class="reference internal" href="blockchain.html#guide-debugging-transactions"><span class="std std-ref">monitors account transactions</span></a> validation errors.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; nem2-cli monitor status --address &lt;your-address-here&gt;
</pre></div>
</div>
<p>Monitoring <code class="docutils literal"><span class="pre">unconfirmed</span></code> shows you in real-time which transactions have reached the network, but are not valid yet.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; nem2-cli monitor unconfirmed --address &lt;your-address-here&gt;
</pre></div>
</div>
<p>See when a transaction involving the provided address gets <code class="docutils literal"><span class="pre">confirmed</span></code>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; nem2-cli monitor confirmed --address &lt;your-address-here&gt;
</pre></div>
</div>
</div>
<div class="section" id="lets-get-into-some-code">
<h3>Let’s get into some code<a class="headerlink" href="#lets-get-into-some-code" title="Permalink to this headline">¶</a></h3>
<p>Alice sends <code class="docutils literal"><span class="pre">10</span> <span class="pre">XEM</span></code> to Bob. She can also include a message, for example <code class="docutils literal"><span class="pre">Welcome</span> <span class="pre">to</span> <span class="pre">NEM</span></code>.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">recipientAddress</span> <span class="o">=</span> <span class="s1">&#39;SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">transferTransaction</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="nx">recipientAddress</span><span class="p">),</span>
    <span class="p">[</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;Welcome To NEM&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">String</span> <span class="n">recipientAddress</span> <span class="o">=</span> <span class="s">&quot;SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&quot;</span><span class="o">;</span>

        <span class="kd">final</span> <span class="n">TransferTransaction</span> <span class="n">transferTransaction</span> <span class="o">=</span> <span class="n">TransferTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
            <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
            <span class="n">Address</span><span class="o">.</span><span class="na">createFromRawAddress</span><span class="o">(</span><span class="n">recipientAddress</span><span class="o">),</span>
            <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">))),</span>
            <span class="n">PlainMessage</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;Welcome To NEM&quot;</span><span class="o">),</span>
            <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">recipientAddress</span> <span class="o">=</span> <span class="s1">&#39;SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">transferTransaction</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="nx">recipientAddress</span><span class="p">),</span>
    <span class="p">[</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;Welcome To NEM&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Although the transaction is created, it has not been announced to the network yet.</p>
<p>To announce it, Alice shall sign the transaction with her account first so that the network can verify its authenticity.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Replace with private key</span>
<span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span><span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">transferTransaction</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Replace with private key</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

        <span class="kd">final</span> <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="na">createFromPrivateKey</span><span class="o">(</span><span class="n">privateKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">signedTransaction</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">transferTransaction</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Replace with private key</span>
<span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span><span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">transferTransaction</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Once signed, Alice can <a class="reference internal" href="../api/announce-transaction.html"><span class="doc">announce the transaction</span></a> to the network.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">signedTransaction</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span> nem2-cli transaction transfer --recipient SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54 --mosaics nem:xem::10000000 --message <span class="s2">&quot;Welcome to NEM&quot;</span>
</pre></div>
</div>
</div>
<p>Open the terminal where you are monitoring account transactions <code class="docutils literal"><span class="pre">status</span></code>, it should be empty. If you see an error, check <a class="reference internal" href="../api/errors.html"><span class="doc">HTTP Error Codes</span></a> and their meaning.</p>
<p>A new transaction should have appeared in the terminal where you are monitoring <code class="docutils literal"><span class="pre">unconfirmed</span></code>. At this point, the transaction has reached the network, but it is not clear if it will get included in a block.</p>
<p>If it is included in a block, the transaction gets processed, and the amount stated in the transaction gets transferred from the sender’s account to the recipient’s account. Additionally, the transaction fee is deducted from the sender’s account.</p>
</div>
<div class="section" id="what-s-next">
<h3>What’s next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h3>
<p>Afterwards, try to send new transfer transactions by altering your code to send multiple mosaics in the same transaction.</p>
<p><strong>Adding multiple mosaics</strong></p>
<div class="figure align-center" id="id24">
<a class="reference internal image-reference" href="../_images/guides-transactions-transfer-multiple.png"><img alt="../_images/guides-transactions-transfer-multiple.png" src="../_images/guides-transactions-transfer-multiple.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text">Sending multiple mosaics in the same transaction</span></p>
</div>
<p>As you may have noticed, transfer transactions require an array of mosaics as a parameter, allowing to create transfer transactions with multiple mosaics at a time.</p>
<p>If you own more than one mosaic, try to send them together in the same transaction by changing the array:</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span>    <span class="p">[</span>
        <span class="k">new</span> <span class="nx">Mosaic</span><span class="p">(</span> <span class="k">new</span> <span class="nx">MosaicId</span><span class="p">(</span><span class="s1">&#39;alice:token&#39;</span><span class="p">),</span> <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
        <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="p">],</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>                <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                        <span class="k">new</span> <span class="n">Mosaic</span><span class="o">(</span><span class="k">new</span> <span class="n">MosaicId</span><span class="o">(</span><span class="s">&quot;alice:token&quot;</span><span class="o">),</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">)),</span>
                        <span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span>
                <span class="o">),</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>    <span class="p">[</span>
        <span class="k">new</span> <span class="nx">Mosaic</span><span class="p">(</span> <span class="k">new</span> <span class="nx">MosaicId</span><span class="p">(</span><span class="s1">&#39;alice:token&#39;</span><span class="p">),</span> <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
        <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="p">],</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nem2-cli transaction transfer --recipient SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54 --mosaics alice:token::10,nem:xem::10000000 --message <span class="s2">&quot;sending multiple mosaics&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sending-a-multisig-transaction">
<span id="guide-sending-a-multisig-transaction"></span><h2>Sending a multisig transaction<a class="headerlink" href="#sending-a-multisig-transaction" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this guide is to create a <a class="reference internal" href="../concepts/multisig-account.html"><span class="doc">multisig</span></a> transaction, learning how <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate bonded transaction</span></a> works.</p>
<p>Then, you will sign and announce the transaction to the network.</p>
<div class="section" id="id1">
<h3>Background<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id25">
<a class="reference internal image-reference" href="../_images/guides-transactions-multisig.png"><img alt="../_images/guides-transactions-multisig.png" src="../_images/guides-transactions-multisig.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Sending an aggregate complete transaction</span></p>
</div>
<p>Alice and Bob live together and have separate accounts. They also have a shared account so that if Bob is out shopping, he can buy groceries for both him and Alice.</p>
<p>This shared account is in NEM translated as 1-of-2 multisig, meaning that one cosignatory needs to cosign the transaction to be included in a block.</p>
<p>Remember that a multisig account has cosignatories accounts, and it cannot start transactions itself. Only the cosignatories can initiate transactions.</p>
</div>
<div class="section" id="id2">
<h3>Prerequisites<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish <a class="reference internal" href="#guide-sending-a-transfer-transaction"><span class="std std-ref">sending a transfer transaction guide</span></a></li>
<li>Finish <a class="reference internal" href="account.html#guide-converting-an-account-to-multisig"><span class="std std-ref">converting an account to multisig guide</span></a></li>
<li>NEM2-SDK</li>
<li>A text editor or IDE</li>
<li>An multisig account with XEM</li>
<li>An cosignatory account with XEM</li>
</ul>
</div>
<div class="section" id="id3">
<h3>Let’s get into some code<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Bob has finished filling his basket, and he is ready to pay. The cashier’s screen indicates that the cost of the purchase is 10 XEM.</p>
<p>Bob needs to know which is the public key of the multisig account that he shares with Alice, and his private key to start announcing the transaction.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Replace with the cosignatory private key</span>
<span class="kr">const</span> <span class="nx">cosignatoryPrivateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">COSIGNATORY_1_PRIVATE_KEY</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>

<span class="c1">// Replace with the multisig public key</span>
<span class="kr">const</span> <span class="nx">multisigAccountPublicKey</span> <span class="o">=</span> <span class="s1">&#39;202B3861F34F6141E120742A64BC787D6EBC59C9EFB996F4856AA9CBEE11CD31&#39;</span><span class="p">;</span>

<span class="c1">// Replace with recipient address</span>
<span class="kr">const</span> <span class="nx">recipientAddress</span> <span class="o">=</span> <span class="s1">&#39;SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">multisigAccount</span> <span class="o">=</span> <span class="nx">PublicAccount</span><span class="p">.</span><span class="nx">createFromPublicKey</span><span class="p">(</span><span class="nx">multisigAccountPublicKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">cosignatoryAccount</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">cosignatoryPrivateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Replace with a Cosignatory&#39;s private key</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">cosignatoryPrivateKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

        <span class="c1">// Replace with a Multisig&#39;s public key</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">multisigAccountPublicKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

        <span class="c1">// Replace with recipient address</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">recipientAddress</span> <span class="o">=</span> <span class="s">&quot;SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&quot;</span><span class="o">;</span>

        <span class="kd">final</span> <span class="n">Account</span> <span class="n">cosignatoryAccount</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="na">createFromPrivateKey</span><span class="o">(</span><span class="n">cosignatoryPrivateKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Replace with the cosignatory private key</span>
<span class="kr">const</span> <span class="nx">cosignatoryPrivateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">COSIGNATORY_1_PRIVATE_KEY</span><span class="p">;</span>

<span class="c1">// Replace with the multisig public key</span>
<span class="kr">const</span> <span class="nx">multisigAccountPublicKey</span> <span class="o">=</span> <span class="s1">&#39;202B3861F34F6141E120742A64BC787D6EBC59C9EFB996F4856AA9CBEE11CD31&#39;</span><span class="p">;</span>

<span class="c1">// Replace with recipient address</span>
<span class="kr">const</span> <span class="nx">recipientAddress</span> <span class="o">=</span> <span class="s1">&#39;SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">multisigAccount</span> <span class="o">=</span> <span class="nx">PublicAccount</span><span class="p">.</span><span class="nx">createFromPublicKey</span><span class="p">(</span><span class="nx">multisigAccountPublicKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">cosignatoryAccount</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">cosignatoryPrivateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>As he wants to pay the groceries with the multisig account, he defines a <a class="reference internal" href="../concepts/transaction.html#transfer-transaction"><span class="std std-ref">transfer transaction</span></a>.</p>
<ul class="simple">
<li>Recipient: Grocery’s address</li>
<li>Message: Grocery payment</li>
<li>Mosaics: [10 XEM]</li>
</ul>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transferTransaction</span><span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="nx">recipientAddress</span><span class="p">),</span>
    <span class="p">[</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;sending 10 nem:xem&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">TransferTransaction</span> <span class="n">transferTransaction</span> <span class="o">=</span> <span class="n">TransferTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">Address</span><span class="o">.</span><span class="na">createFromRawAddress</span><span class="o">(</span><span class="n">recipientAddress</span><span class="o">),</span>
                <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">))),</span>
                <span class="n">PlainMessage</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;sending 10 nem:xem&quot;</span><span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transferTransaction</span><span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="nx">recipientAddress</span><span class="p">),</span>
    <span class="p">[</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;sending 10 nem:xem&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Wrap the transfer transaction under an <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate transaction</span></a>, attaching multisig public key as the signer.</p>
<p>An aggregate transaction is <strong>complete</strong> if before announcing it to the network, all required cosigners have signed it. If valid, it will be included in a block.</p>
<p>Remember that we are using a 1-of-2 multisig account? As Bob has one private key to sign the transaction, consider an <em>aggregate complete transaction</em>.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createComplete</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">transferTransaction</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">multisigAccount</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
    <span class="p">[]</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">AggregateTransaction</span> <span class="n">aggregateTransaction</span> <span class="o">=</span> <span class="n">AggregateTransaction</span><span class="o">.</span><span class="na">createComplete</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span>
                        <span class="n">transferTransaction</span><span class="o">.</span><span class="na">toAggregate</span><span class="o">(</span><span class="n">multisigPublicAccount</span><span class="o">)</span>
                <span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createComplete</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">transferTransaction</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">multisigAccount</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
    <span class="p">[]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Then, he signs and announces the transaction.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">//Signing the aggregate transaction</span>
<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">cosignatoryAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>

<span class="c1">//Creating the lock funds transaction and announce it</span>


<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>


<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">aggregateSignedTransaction</span> <span class="o">=</span> <span class="n">cosignatoryAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">aggregateTransaction</span><span class="o">);</span>


        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">//Signing the aggregate transaction</span>
<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">cosignatoryAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>

<span class="c1">//Creating the lock funds transaction and announce it</span>


<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>


<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>What’s next?<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>What would have happened if the account were a 2-of-2 multisig instead of a 1-of-2?</p>
<p>As all required cosigners didn’t sign the transaction, it should be announced as <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate bonded</span></a>.</p>
<div class="figure align-center" id="id26">
<a class="reference internal image-reference" href="../_images/guides-transactions-multisig-2.png"><img alt="../_images/guides-transactions-multisig-2.png" src="../_images/guides-transactions-multisig-2.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Sending an aggregate bonded transaction</span></p>
</div>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createBonded</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">transferTransaction</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">multisigAccount</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">AggregateTransaction</span> <span class="n">aggregateTransaction</span> <span class="o">=</span> <span class="n">AggregateTransaction</span><span class="o">.</span><span class="na">createBonded</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                        <span class="n">transferTransaction</span><span class="o">.</span><span class="na">toAggregate</span><span class="o">(</span><span class="n">multisigPublicAccount</span><span class="o">)</span>
                <span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createBonded</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">transferTransaction</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">multisigAccount</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Open a new terminal for <a class="reference internal" href="blockchain.html#guide-debugging-transactions"><span class="std std-ref">monitoring</span></a> the aggregate bonded transaction.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; nem2-cli monitor aggregatebonded --address &lt;your-address-here&gt;
</pre></div>
</div>
<p>When an aggregate transaction is bonded, Bob needs to lock at least 10 XEM.</p>
<p>Once all cosigners sign the transaction, the amount of XEM becomes available again on Bob’s account.</p>
<p>After <a class="reference internal" href="../concepts/transaction.html#lock-funds-transaction"><span class="std std-ref">locks fund transaction</span></a> has been confirmed, <a class="reference internal" href="../api/announce-transaction.html"><span class="doc">announce the aggregate bonded transaction</span></a>.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">//Signing the aggregate transaction</span>
<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">cosignatoryAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>

<span class="c1">//Creating the lock funds transaction and announce it</span>

<span class="kr">const</span> <span class="nx">lockFundsTransaction</span> <span class="o">=</span> <span class="nx">LockFundsTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">480</span><span class="p">),</span>
    <span class="nx">signedTransaction</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="nx">cosignatoryAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">lockFundsTransaction</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="c1">// announce signed transaction</span>
<span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">lockFundsTransactionSigned</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

    <span class="nx">listener</span><span class="p">.</span><span class="nx">confirmed</span><span class="p">(</span><span class="nx">cosignatoryAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">transaction</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span> <span class="o">&amp;&amp;</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span><span class="p">.</span><span class="nx">hash</span> <span class="o">==</span> <span class="nx">lockFundsTransactionSigned</span><span class="p">.</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBonded</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">aggregateSignedTransaction</span> <span class="o">=</span> <span class="n">cosignatoryAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">aggregateTransaction</span><span class="o">);</span>

        <span class="c1">// Creating the lock funds transaction and announce it</span>

        <span class="kd">final</span> <span class="n">LockFundsTransaction</span> <span class="n">lockFundsTransaction</span> <span class="o">=</span> <span class="n">LockFundsTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">)),</span>
                <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">480</span><span class="o">),</span>
                <span class="n">aggregateSignedTransaction</span><span class="o">,</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="n">cosignatoryAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">lockFundsTransaction</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">lockFundsTransactionSigned</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lockFundsTransactionSigned</span><span class="o">.</span><span class="na">getHash</span><span class="o">());</span>

        <span class="kd">final</span> <span class="n">Listener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Listener</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">listener</span><span class="o">.</span><span class="na">open</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="na">confirmed</span><span class="o">(</span><span class="n">cosignatoryAccount</span><span class="o">.</span><span class="na">getAddress</span><span class="o">()).</span><span class="na">take</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">transaction</span><span class="o">);</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announceAggregateBonded</span><span class="o">(</span><span class="n">aggregateSignedTransaction</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">//Signing the aggregate transaction</span>
<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">cosignatoryAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>

<span class="c1">//Creating the lock funds transaction and announce it</span>

<span class="kr">const</span> <span class="nx">lockFundsTransaction</span> <span class="o">=</span> <span class="nx">LockFundsTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">480</span><span class="p">),</span>
    <span class="nx">signedTransaction</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="nx">cosignatoryAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">lockFundsTransaction</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="c1">// announce signed transaction</span>
<span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">lockFundsTransactionSigned</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

    <span class="nx">listener</span><span class="p">.</span><span class="nx">confirmed</span><span class="p">(</span><span class="nx">cosignatoryAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">transaction</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span> <span class="o">&amp;&amp;</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span><span class="p">.</span><span class="nx">hash</span> <span class="o">==</span> <span class="nx">lockFundsTransactionSigned</span><span class="p">.</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBonded</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>Alice should <a class="reference internal" href="#guide-signing-announced-aggregate-bonded-transactions"><span class="std std-ref">cosign the transaction</span></a> to be confirmed!</p>
</div>
</div>
<div class="section" id="sending-payouts-with-aggregate-complete-transaction">
<span id="guide-sending-payouts-with-aggregate-complete-transaction"></span><h2>Sending payouts with aggregate complete transaction<a class="headerlink" href="#sending-payouts-with-aggregate-complete-transaction" title="Permalink to this headline">¶</a></h2>
<p>This guide explains how to send transactions to different accounts atomically, using an <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate complete transaction</span></a>.</p>
<div class="section" id="id5">
<h3>Background<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>It is Christmas, and uncle Dan wants to send money to their nephews Alice and Bob.</p>
<div class="figure align-center" id="id27">
<a class="reference internal image-reference" href="../_images/guides-transactions-sending-payouts1.png"><img alt="../_images/guides-transactions-sending-payouts1.png" src="../_images/guides-transactions-sending-payouts1.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text">Sending transactions to different recipients atomically</span></p>
</div>
<p>He chooses to send an aggregate complete transaction, so both of them will receive the funds at the same time.</p>
</div>
<div class="section" id="id6">
<h3>Prerequisites<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish <a class="reference internal" href="#guide-sending-a-transfer-transaction"><span class="std std-ref">sending a transfer transaction guide</span></a></li>
<li>NEM2-SDK</li>
<li>A text editor or IDE</li>
<li>An account with XEM</li>
</ul>
</div>
<div class="section" id="let-s-get-into-some-code">
<h3>Let’s get into some code?<a class="headerlink" href="#let-s-get-into-some-code" title="Permalink to this headline">¶</a></h3>
<p>First, Dan creates two <a class="reference internal" href="../concepts/transaction.html#transfer-transaction"><span class="std std-ref">transfer transaction</span></a> with two different recipients, and wrap them in an <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate transaction</span></a>.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Replace with private key</span>
<span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>

<span class="c1">// Replace with addresses</span>
<span class="kr">const</span> <span class="nx">brotherAddress</span> <span class="o">=</span> <span class="s1">&#39;SDG4WG-FS7EQJ-KFQKXM-4IUCQG-PXUW5H-DJVIJB-OXJG&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">sisterAddress</span> <span class="o">=</span> <span class="s1">&#39;SCGPXB-2A7T4I-W5MQCX-FQY4UQ-W5JNU5-F55HGK-HBUN&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">brotherAccount</span> <span class="o">=</span> <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="nx">brotherAddress</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">sisterAccount</span> <span class="o">=</span> <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="nx">sisterAddress</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// 10 xem represent 10 000 000 micro xem</span>

<span class="kr">const</span> <span class="nx">brotherTransferTransaction</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span> <span class="nx">brotherAccount</span><span class="p">,</span> <span class="p">[</span><span class="nx">amount</span><span class="p">],</span> <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;payout&#39;</span><span class="p">),</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">sisterTransferTransaction</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span> <span class="nx">sisterAccount</span><span class="p">,</span> <span class="p">[</span><span class="nx">amount</span><span class="p">],</span> <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;payout&#39;</span><span class="p">),</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createComplete</span><span class="p">(</span><span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">brotherTransferTransaction</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">),</span>
        <span class="nx">sisterTransferTransaction</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">)],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
    <span class="p">[]);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Replace with private key</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

        <span class="kd">final</span> <span class="n">Address</span> <span class="n">brotherAddress</span> <span class="o">=</span> <span class="n">Address</span><span class="o">.</span><span class="na">createFromRawAddress</span><span class="o">(</span><span class="s">&quot;SDG4WG-FS7EQJ-KFQKXM-4IUCQG-PXUW5H-DJVIJB-OXJG&quot;</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">Address</span> <span class="n">sisterAddress</span> <span class="o">=</span> <span class="n">Address</span><span class="o">.</span><span class="na">createFromRawAddress</span><span class="o">(</span><span class="s">&quot;SCGPXB-2A7T4I-W5MQCX-FQY4UQ-W5JNU5-F55HGK-HBUN&quot;</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="na">createFromPrivateKey</span><span class="o">(</span><span class="n">privateKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">XEM</span> <span class="n">xem</span> <span class="o">=</span> <span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span> <span class="c1">// 10 xem represent 10 000 000 micro xem</span>

        <span class="kd">final</span> <span class="n">TransferTransaction</span> <span class="n">brotherTransferTransaction</span> <span class="o">=</span> <span class="n">TransferTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">brotherAddress</span><span class="o">,</span>
                <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">xem</span><span class="o">),</span>
                <span class="n">PlainMessage</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;payout&quot;</span><span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">TransferTransaction</span> <span class="n">sisterTransferTransaction</span> <span class="o">=</span> <span class="n">TransferTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">sisterAddress</span><span class="o">,</span>
                <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">xem</span><span class="o">),</span>
                <span class="n">PlainMessage</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;payout&quot;</span><span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">AggregateTransaction</span> <span class="n">aggregateTransaction</span> <span class="o">=</span> <span class="n">AggregateTransaction</span><span class="o">.</span><span class="na">createComplete</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                        <span class="n">brotherTransferTransaction</span><span class="o">.</span><span class="na">toAggregate</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">()),</span>
                        <span class="n">sisterTransferTransaction</span><span class="o">.</span><span class="na">toAggregate</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">())</span>
                <span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Replace with private key</span>
<span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span><span class="p">;</span>

<span class="c1">// Replace with addresses</span>
<span class="kr">const</span> <span class="nx">brotherAddress</span> <span class="o">=</span> <span class="s1">&#39;SDG4WG-FS7EQJ-KFQKXM-4IUCQG-PXUW5H-DJVIJB-OXJG&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">sisterAddress</span> <span class="o">=</span> <span class="s1">&#39;SCGPXB-2A7T4I-W5MQCX-FQY4UQ-W5JNU5-F55HGK-HBUN&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">brotherAccount</span> <span class="o">=</span> <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="nx">brotherAddress</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">sisterAccount</span> <span class="o">=</span> <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="nx">sisterAddress</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// 10 xem represent 10 000 000 micro xem</span>

<span class="kr">const</span> <span class="nx">brotherTransferTransaction</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span> <span class="nx">brotherAccount</span><span class="p">,</span> <span class="p">[</span><span class="nx">amount</span><span class="p">],</span> <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;payout&#39;</span><span class="p">),</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">sisterTransferTransaction</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span> <span class="nx">sisterAccount</span><span class="p">,</span> <span class="p">[</span><span class="nx">amount</span><span class="p">],</span> <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;payout&#39;</span><span class="p">),</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createComplete</span><span class="p">(</span><span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">brotherTransferTransaction</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">),</span>
        <span class="nx">sisterTransferTransaction</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">)],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
    <span class="p">[]);</span>
</pre></div>
</div>
</div>
<p>Do you know the difference between aggregate complete and aggregate bonded? In this case, one private key can sign all the transactions in the aggregate, so it is <em>aggregate complete</em>.</p>
<p>That means that there is no need to lock funds to send the transaction. If valid, it will be accepted by the network.</p>
<p>Just sign it and announce it!</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>

<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">signedTransaction</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">aggregateTransaction</span><span class="o">);</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">signedTransaction</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>

<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>What’s next?<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Try to send an aggregate bonded transaction by following <a class="reference internal" href="#guide-creating-an-escrow-with-aggregate-bonded-transaction"><span class="std std-ref">creating an escrow with aggregate bonded transaction</span></a> guide.</p>
</div>
</div>
<div class="section" id="creating-an-escrow-with-aggregate-bonded-transaction">
<span id="guide-creating-an-escrow-with-aggregate-bonded-transaction"></span><h2>Creating an escrow with aggregate bonded transaction<a class="headerlink" href="#creating-an-escrow-with-aggregate-bonded-transaction" title="Permalink to this headline">¶</a></h2>
<p>This guide will run you through NEM general concepts, and precisely <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate bonded transaction</span></a>, by creating an escrow.</p>
<div class="section" id="id8">
<h3>Background<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>An <strong>escrow</strong> is a <code class="docutils literal"><span class="pre">contractual</span> <span class="pre">arrangement</span></code> in which a <code class="docutils literal"><span class="pre">third</span> <span class="pre">party</span> <span class="pre">receives</span> <span class="pre">and</span> <span class="pre">disburses</span> <span class="pre">money</span></code> or documents for the <code class="docutils literal"><span class="pre">primary</span> <span class="pre">transacting</span> <span class="pre">parties</span></code>, with the disbursement dependent on <code class="docutils literal"><span class="pre">conditions</span> <span class="pre">agreed</span> <span class="pre">to</span> <span class="pre">by</span> <span class="pre">the</span> <span class="pre">transacting</span> <span class="pre">parties</span></code>, or an <code class="docutils literal"><span class="pre">account</span> <span class="pre">established</span> <span class="pre">by</span> <span class="pre">a</span> <span class="pre">broker</span> <span class="pre">for</span> <span class="pre">holding</span> <span class="pre">funds</span></code> on behalf of the broker’s principal or some other person <code class="docutils literal"><span class="pre">until</span> <span class="pre">the</span> <span class="pre">consummation</span> <span class="pre">or</span> <span class="pre">termination</span> <span class="pre">of</span> <span class="pre">a</span> <span class="pre">transaction</span></code>; or, a trust account held in the borrower’s name to pay obligations such as property taxes and insurance premiums.</p>
<p>See full description at <a href="https://en.wikipedia.org/wiki/Escrow" target="_blank">Wikipedia</a>.</p>
<p>In this example, imagine the two parties agree in a virtual service, implying that the <strong>escrow can be immediate</strong>.</p>
<p><strong>How does it work?</strong></p>
<ol class="arabic simple">
<li>Buyer and seller agree to terms</li>
<li>Buyer submits payment to escrow</li>
<li>Seller delivers goods or service to Buyer</li>
<li>Buyer approves goods or service</li>
<li>Escrow releases payment to the seller</li>
</ol>
<p><strong>How is it applied to NEM?</strong></p>
<p>Normalizing the language into NEM related concepts:</p>
<dl class="docutils">
<dt><strong>contractual arrangement</strong></dt>
<dd>Aggregate Transaction</dd>
<dt><strong>third party receives and disburses money</strong></dt>
<dd>No third party</dd>
<dt><strong>primary transacting parties</strong></dt>
<dd>Accounts</dd>
<dt><strong>conditions agreed to by the transacting parties</strong></dt>
<dd>Sign transaction</dd>
<dt><strong>account established by a broker for holding funds</strong></dt>
<dd>No account, just an atomic swap</dd>
<dt><strong>until the consummation or termination of a transaction</strong></dt>
<dd>The transaction included in a block</dd>
</dl>
</div>
<div class="section" id="id9">
<h3>Prerequisites<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish <a class="reference internal" href="mosaic.html#guide-creating-a-mosaic"><span class="std std-ref">creating a mosaic guide</span></a></li>
<li>Finish <a class="reference internal" href="#guide-sending-payouts-with-aggregate-complete-transaction"><span class="std std-ref">sending payouts with aggregate complete transactions</span></a></li>
<li>NEM2-SDK</li>
<li>A text editor or IDE</li>
</ul>
</div>
<div class="section" id="id10">
<h3>Let’s get into some code?<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id28">
<a class="reference internal image-reference" href="../_images/guides-transactions-escrow1.png"><img alt="../_images/guides-transactions-escrow1.png" src="../_images/guides-transactions-escrow1.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text">Multi-Asset Escrowed Transactions</span></p>
</div>
<p><strong>Setting up the required accounts and mosaics</strong></p>
<p>In this example, Alice and a ticket distributor want to swap the following assets.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Owner</th>
<th class="head">Mosaic Name</th>
<th class="head">Amount</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Alice</td>
<td>nem:xem</td>
<td>100</td>
</tr>
<tr class="row-odd"><td>Ticket distributor</td>
<td>museum:ticket</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Before continuing, practise by setting up set up the namespaces and mosaics required.</p>
<p><strong>Mosaics swap</strong></p>
<p>Alice will send a transaction to the ticket distributor exchanging 100 nem:xem with 1 museum:ticket.</p>
<p>Create two  <a class="reference internal" href="../concepts/transaction.html#transfer-transaction"><span class="std std-ref">transfer transaction</span></a>:</p>
<ol class="arabic simple">
<li>From Alice to the ticket distributor sending 100 nem:xem</li>
<li>From the ticket distributor to Alice sending 1 museum:ticket.</li>
</ol>
<p>Add them as <code class="docutils literal"><span class="pre">innerTransactions</span></code> under an <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate transaction</span></a>.</p>
<p>An aggregate Transaction is <em>complete</em> if before announcing it to the network, all required cosigners have signed it. If valid, it will be included in a block.</p>
<p>In case that requires signatures from other participants but announced to the network, then the transaction is considered <em>aggregate bonded</em>.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Replace with private key</span>
<span class="kr">const</span> <span class="nx">alicePrivateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>

<span class="c1">// Replace with public key</span>
<span class="kr">const</span> <span class="nx">ticketDistributorPublicKey</span> <span class="o">=</span> <span class="s1">&#39;F82527075248B043994F1CAFD965F3848324C9ABFEC506BC05FBCF5DD7307C9D&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">aliceAccount</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">alicePrivateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">ticketDistributorPublicAccount</span> <span class="o">=</span> <span class="nx">PublicAccount</span><span class="p">.</span><span class="nx">createFromPublicKey</span><span class="p">(</span> <span class="nx">ticketDistributorPublicKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">aliceToTicketDistributorTx</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">ticketDistributorPublicAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">100</span><span class="p">)],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;send 100 nem:xem to distributor&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">ticketDistributorToAliceTx</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="p">[</span><span class="k">new</span> <span class="nx">Mosaic</span><span class="p">(</span> <span class="k">new</span> <span class="nx">MosaicId</span><span class="p">(</span><span class="s1">&#39;museum:ticket&#39;</span><span class="p">),</span> <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">1</span><span class="p">))],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;send 1 museum:ticket to alice&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createBonded</span><span class="p">(</span><span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">aliceToTicketDistributorTx</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">),</span>
        <span class="nx">ticketDistributorToAliceTx</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">ticketDistributorPublicAccount</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>


<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Replace with private key</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">alicePrivateKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

        <span class="c1">// Replace with public key</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">ticketDistributorPublicKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

        <span class="kd">final</span> <span class="n">Account</span> <span class="n">aliceAccount</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="na">createFromPrivateKey</span><span class="o">(</span><span class="n">alicePrivateKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">PublicAccount</span> <span class="n">ticketDistributorPublicAccount</span> <span class="o">=</span> <span class="n">PublicAccount</span><span class="o">.</span><span class="na">createFromPublicKey</span><span class="o">(</span><span class="n">ticketDistributorPublicKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">TransferTransaction</span> <span class="n">aliceToTicketDistributorTx</span> <span class="o">=</span> <span class="n">TransferTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">ticketDistributorPublicAccount</span><span class="o">.</span><span class="na">getAddress</span><span class="o">(),</span>
            <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">100</span><span class="o">))),</span>
                <span class="n">PlainMessage</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;send 100 nem:xem to distributor&quot;</span><span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">TransferTransaction</span> <span class="n">ticketDistributorToAliceTx</span> <span class="o">=</span> <span class="n">TransferTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">aliceAccount</span><span class="o">.</span><span class="na">getAddress</span><span class="o">(),</span>
                <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="k">new</span> <span class="n">Mosaic</span><span class="o">(</span><span class="k">new</span> <span class="n">MosaicId</span><span class="o">(</span><span class="s">&quot;museum:ticket&quot;</span><span class="o">),</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span>
                <span class="n">PlainMessage</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;send 1 museum:ticket to alice&quot;</span><span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">AggregateTransaction</span> <span class="n">aggregateTransaction</span> <span class="o">=</span> <span class="n">AggregateTransaction</span><span class="o">.</span><span class="na">createBonded</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                        <span class="n">aliceToTicketDistributorTx</span><span class="o">.</span><span class="na">toAggregate</span><span class="o">(</span><span class="n">aliceAccount</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">()),</span>
                        <span class="n">ticketDistributorToAliceTx</span><span class="o">.</span><span class="na">toAggregate</span><span class="o">(</span><span class="n">ticketDistributorPublicAccount</span><span class="o">)</span>
                <span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">aggregateSignedTransaction</span> <span class="o">=</span> <span class="n">aliceAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">aggregateTransaction</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Replace with private key</span>
<span class="kr">const</span> <span class="nx">alicePrivateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span><span class="p">;</span>

<span class="c1">// Replace with public key</span>
<span class="kr">const</span> <span class="nx">ticketDistributorPublicKey</span> <span class="o">=</span> <span class="s1">&#39;F82527075248B043994F1CAFD965F3848324C9ABFEC506BC05FBCF5DD7307C9D&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">aliceAccount</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">alicePrivateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">ticketDistributorPublicAccount</span> <span class="o">=</span> <span class="nx">PublicAccount</span><span class="p">.</span><span class="nx">createFromPublicKey</span><span class="p">(</span> <span class="nx">ticketDistributorPublicKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">aliceToTicketDistributorTx</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">ticketDistributorPublicAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">100</span><span class="p">)],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;send 100 nem:xem to distributor&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">ticketDistributorToAliceTx</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="p">[</span><span class="k">new</span> <span class="nx">Mosaic</span><span class="p">(</span> <span class="k">new</span> <span class="nx">MosaicId</span><span class="p">(</span><span class="s1">&#39;museum:ticket&#39;</span><span class="p">),</span> <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">1</span><span class="p">))],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;send 1 museum:ticket to alice&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createBonded</span><span class="p">(</span><span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">aliceToTicketDistributorTx</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">),</span>
        <span class="nx">ticketDistributorToAliceTx</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">ticketDistributorPublicAccount</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>


<span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>When an aggregate transaction is bonded, Alice will need to lock at least 10 XEM.</p>
<p>Once the ticket distributor signs the aggregate transaction, the amount of locked XEM becomes available again on Alice’s account, and the exchange will get through.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Creating the lock funds transaction</span>

<span class="kr">const</span> <span class="nx">lockFundsTransaction</span> <span class="o">=</span> <span class="nx">LockFundsTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">480</span><span class="p">),</span>
    <span class="nx">signedTransaction</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">lockFundsTransaction</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="c1">// announce signed transaction</span>
<span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">lockFundsTransactionSigned</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

    <span class="nx">listener</span><span class="p">.</span><span class="nx">confirmed</span><span class="p">(</span><span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">transaction</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span> <span class="o">&amp;&amp;</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span><span class="p">.</span><span class="nx">hash</span> <span class="o">==</span> <span class="nx">lockFundsTransactionSigned</span><span class="p">.</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBonded</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Creating the lock funds transaction and announce it</span>

        <span class="kd">final</span> <span class="n">LockFundsTransaction</span> <span class="n">lockFundsTransaction</span> <span class="o">=</span> <span class="n">LockFundsTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">)),</span>
                <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">480</span><span class="o">),</span>
                <span class="n">aggregateSignedTransaction</span><span class="o">,</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="n">aliceAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">lockFundsTransaction</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">lockFundsTransactionSigned</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lockFundsTransactionSigned</span><span class="o">.</span><span class="na">getHash</span><span class="o">());</span>

        <span class="kd">final</span> <span class="n">Listener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Listener</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">listener</span><span class="o">.</span><span class="na">open</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="na">confirmed</span><span class="o">(</span><span class="n">aliceAccount</span><span class="o">.</span><span class="na">getAddress</span><span class="o">()).</span><span class="na">take</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announceAggregateBonded</span><span class="o">(</span><span class="n">aggregateSignedTransaction</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Creating the lock funds transaction</span>

<span class="kr">const</span> <span class="nx">lockFundsTransaction</span> <span class="o">=</span> <span class="nx">LockFundsTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">480</span><span class="p">),</span>
    <span class="nx">signedTransaction</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">lockFundsTransaction</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="c1">// announce signed transaction</span>
<span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">lockFundsTransactionSigned</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

    <span class="nx">listener</span><span class="p">.</span><span class="nx">confirmed</span><span class="p">(</span><span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">transaction</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span> <span class="o">&amp;&amp;</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span><span class="p">.</span><span class="nx">hash</span> <span class="o">==</span> <span class="nx">lockFundsTransactionSigned</span><span class="p">.</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBonded</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="is-it-possible-without-aggregate-transactions">
<h3>Is it possible without aggregate transactions?<a class="headerlink" href="#is-it-possible-without-aggregate-transactions" title="Permalink to this headline">¶</a></h3>
<p><strong>It is not secure</strong>, since something of the next list could happen:</p>
<ul class="simple">
<li>The buyer doesn’t pay.</li>
<li>The seller doesn’t send the virtual goods.</li>
</ul>
</div>
<div class="section" id="id11">
<h3>What’s next?<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>The distributor didn’t sign the aggregate bonded transaction yet, so exchange has not been completed. Consider reading <a class="reference internal" href="#guide-signing-announced-aggregate-bonded-transactions"><span class="std std-ref">signing announced aggregate bonded transactions guide</span></a>.</p>
<p>Afterwards, swap mosaics between multiple participants.</p>
<div class="figure align-center" id="id29">
<a class="reference internal image-reference" href="../_images/guides-transactions-escrow-2.png"><img alt="../_images/guides-transactions-escrow-2.png" src="../_images/guides-transactions-escrow-2.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Multi-Asset Escrowed Transactions</span></p>
</div>
</div>
</div>
<div class="section" id="asking-for-mosaics-with-aggregate-bonded-transaction">
<span id="guide-asking-for-mosaics-with-aggregate-bonded-transaction"></span><h2>Asking for mosaics with aggregate bonded transaction<a class="headerlink" href="#asking-for-mosaics-with-aggregate-bonded-transaction" title="Permalink to this headline">¶</a></h2>
<p>This guide shows you how to ask an account to send you some mosaics using an <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate bonded transaction</span></a>.</p>
<div class="section" id="id12">
<h3>Prerequisites<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish <a class="reference internal" href="#guide-creating-an-escrow-with-aggregate-bonded-transaction"><span class="std std-ref">creating an escrow with aggregate bonded transaction guide</span></a></li>
<li>A text editor or IDE</li>
<li>An account with XEM</li>
</ul>
</div>
<div class="section" id="id13">
<h3>Let’s get into some code<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id30">
<a class="reference internal image-reference" href="../_images/guides-transactions-asking-for-mosaics.png"><img alt="../_images/guides-transactions-asking-for-mosaics.png" src="../_images/guides-transactions-asking-for-mosaics.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text">Asking for mosaics with an aggregate bonded transaction</span></p>
</div>
<p>Alice wants to ask Bob for 20 XEM.</p>
<p>Alice creates an aggregate bonded transaction with two inner transactions:</p>
<p>Inner <a class="reference internal" href="../concepts/transaction.html#transfer-transaction"><span class="std std-ref">transfer transaction</span></a> 1:</p>
<ul class="simple">
<li>message: “message reason” (custom, but not empty)</li>
<li>receiver: Bob address</li>
<li>signer: Alice</li>
</ul>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transferTransaction1</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">bobAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="p">[],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;send me 20 XEM&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">TransferTransaction</span> <span class="n">transferTransaction1</span> <span class="o">=</span> <span class="n">TransferTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
            <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
            <span class="n">bobPublicAccount</span><span class="o">.</span><span class="na">getAddress</span><span class="o">(),</span>
            <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">(),</span>
            <span class="n">PlainMessage</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;send me 20 XEM&quot;</span><span class="o">),</span>
            <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transferTransaction1</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">bobAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="p">[],</span>
    <span class="nx">PlainMessage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;send me 20 XEM&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Inner transfer transaction 2:</p>
<ul class="simple">
<li>message: empty</li>
<li>receiver: Alice address</li>
<li>mosaics: 20 XEM</li>
<li>signer: Bob</li>
</ul>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transferTransaction2</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
    <span class="nx">EmptyMessage</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">TransferTransaction</span> <span class="n">transferTransaction2</span> <span class="o">=</span> <span class="n">TransferTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">aliceAccount</span><span class="o">.</span><span class="na">getAddress</span><span class="o">(),</span>
                <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">20</span><span class="o">))),</span>
                <span class="n">PlainMessage</span><span class="o">.</span><span class="na">Empty</span><span class="o">,</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">transferTransaction2</span> <span class="o">=</span> <span class="nx">TransferTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
    <span class="nx">EmptyMessage</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Aggregate transaction:</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createBonded</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">transferTransaction1</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">),</span>
        <span class="nx">transferTransaction2</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">bobAccount</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">AggregateTransaction</span> <span class="n">pullTransaction</span> <span class="o">=</span> <span class="n">AggregateTransaction</span><span class="o">.</span><span class="na">createBonded</span><span class="o">(</span>
            <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
            <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                <span class="n">transferTransaction1</span><span class="o">.</span><span class="na">toAggregate</span><span class="o">(</span><span class="n">aliceAccount</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">()),</span>
                <span class="n">transferTransaction2</span><span class="o">.</span><span class="na">toAggregate</span><span class="o">(</span><span class="n">bobPublicAccount</span><span class="o">)</span>
            <span class="o">),</span>
            <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">aggregateTransaction</span> <span class="o">=</span> <span class="nx">AggregateTransaction</span><span class="p">.</span><span class="nx">createBonded</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="nx">transferTransaction1</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">),</span>
        <span class="nx">transferTransaction2</span><span class="p">.</span><span class="nx">toAggregate</span><span class="p">(</span><span class="nx">bobAccount</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Alice signs the aggregate bonded transaction and announces it to the network, locking first 10 XEM.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>

<span class="c1">//Creating the lock funds transaction and announce it</span>
<span class="kr">const</span> <span class="nx">lockFundsTransaction</span> <span class="o">=</span> <span class="nx">LockFundsTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">480</span><span class="p">),</span>
    <span class="nx">signedTransaction</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">lockFundsTransaction</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">lockFundsTransactionSigned</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

    <span class="nx">listener</span><span class="p">.</span><span class="nx">confirmed</span><span class="p">(</span><span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">transaction</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span> <span class="o">&amp;&amp;</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span><span class="p">.</span><span class="nx">hash</span> <span class="o">==</span> <span class="nx">lockFundsTransactionSigned</span><span class="p">.</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBonded</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">pullTransactionSigned</span> <span class="o">=</span> <span class="n">aliceAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">pullTransaction</span><span class="o">);</span>

        <span class="c1">// Creating the lock funds transaction and announce it</span>
        <span class="kd">final</span> <span class="n">LockFundsTransaction</span> <span class="n">lockFundsTransaction</span> <span class="o">=</span> <span class="n">LockFundsTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
            <span class="n">Deadline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
            <span class="n">XEM</span><span class="o">.</span><span class="na">createRelative</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">)),</span>
            <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">480</span><span class="o">),</span>
            <span class="n">pullTransactionSigned</span><span class="o">,</span>
            <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="n">aliceAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">lockFundsTransaction</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">lockFundsTransactionSigned</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lockFundsTransactionSigned</span><span class="o">.</span><span class="na">getHash</span><span class="o">());</span>

        <span class="kd">final</span> <span class="n">Listener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Listener</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">listener</span><span class="o">.</span><span class="na">open</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="na">confirmed</span><span class="o">(</span><span class="n">aliceAccount</span><span class="o">.</span><span class="na">getAddress</span><span class="o">()).</span><span class="na">take</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announceAggregateBonded</span><span class="o">(</span><span class="n">pullTransactionSigned</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">signedTransaction</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>

<span class="c1">//Creating the lock funds transaction and announce it</span>
<span class="kr">const</span> <span class="nx">lockFundsTransaction</span> <span class="o">=</span> <span class="nx">LockFundsTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">480</span><span class="p">),</span>
    <span class="nx">signedTransaction</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">lockFundsTransactionSigned</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">lockFundsTransaction</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">lockFundsTransactionSigned</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

    <span class="nx">listener</span><span class="p">.</span><span class="nx">confirmed</span><span class="p">(</span><span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">transaction</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span> <span class="o">&amp;&amp;</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">transactionInfo</span><span class="p">.</span><span class="nx">hash</span> <span class="o">==</span> <span class="nx">lockFundsTransactionSigned</span><span class="p">.</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBonded</span><span class="p">(</span><span class="nx">signedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>If all goes well, Bob receives a notification via <a class="reference internal" href="blockchain.html#guide-debugging-transactions"><span class="std std-ref">WebSocket</span></a> (or fetched via <a class="reference internal" href="account.html#guide-receiving-transactions-of-an-account"><span class="std std-ref">API Http request</span></a>).</p>
</div>
<div class="section" id="id14">
<h3>What’s next?<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Bob didn’t cosign the transaction yet. Consider reading <a class="reference internal" href="#guide-signing-announced-aggregate-bonded-transactions"><span class="std std-ref">signing announced aggregate bonded transactions guide</span></a>.</p>
<p>After receiving the transaction, Bob signs the <code class="docutils literal"><span class="pre">transaction</span> <span class="pre">hash</span></code> and announces the cosignature signed transaction.</p>
<p>As the aggregate bonded transaction has all the cosignatures required, it will be included in a block.</p>
</div>
</div>
<div class="section" id="signing-announced-aggregate-bonded-transactions">
<span id="guide-signing-announced-aggregate-bonded-transactions"></span><h2>Signing announced aggregate bonded transactions<a class="headerlink" href="#signing-announced-aggregate-bonded-transactions" title="Permalink to this headline">¶</a></h2>
<p>You probably have announced an <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate bonded transaction</span></a>, but all cosigners have not signed it yet.</p>
<p>This guide will help you to cosign aggregate bonded transactions that require being signed by your account.</p>
<div class="section" id="id15">
<h3>Prerequisites<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish <a class="reference internal" href="#guide-creating-an-escrow-with-aggregate-bonded-transaction"><span class="std std-ref">creating an escrow with aggregate bonded transaction guide</span></a></li>
<li>Received some aggregate bonded transaction</li>
<li>NEM2-SDK</li>
<li>A text editor or IDE</li>
<li>An account with XEM</li>
</ul>
</div>
<div class="section" id="id16">
<h3>Let’s get into some code<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>Fetch all aggregate bonded transactions that require being signed by your account.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Replace with a private key</span>
<span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">accountHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AccountHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">accountHttp</span><span class="p">.</span><span class="nx">aggregateBondedTransactions</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">flatMap</span><span class="p">((</span><span class="nx">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">_</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">signedByAccount</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Replace with a private key</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

        <span class="kd">final</span> <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="na">createFromPrivateKey</span><span class="o">(</span><span class="n">privateKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">AccountHttp</span> <span class="n">accountHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AccountHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">accountHttp</span><span class="o">.</span><span class="na">aggregateBondedTransactions</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">())</span>
                <span class="o">.</span><span class="na">flatMapIterable</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="n">tx</span><span class="o">)</span> <span class="c1">// Transform transaction array to single transactions to process them</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">tx</span><span class="o">.</span><span class="na">signedByAccount</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">()))</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Replace with a private key</span>
<span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">accountHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AccountHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">accountHttp</span><span class="p">.</span><span class="nx">aggregateBondedTransactions</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">flatMap</span><span class="p">((</span><span class="nx">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">_</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">signedByAccount</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To fetch aggregate bonded transactions that should be signed by multisig cosignatories, refer to the multisig public key instead. See <a class="reference internal" href="account.html#guide-get-multisig-account-info"><span class="std std-ref">how to get multisig accounts where an account is cosignatory</span></a>.</p>
</div>
<p>For each aggregate bonded transaction that you want to sign, create a <a class="reference internal" href="../concepts/transaction.html#cosignature-transaction"><span class="std std-ref">cosignature transaction</span></a> with it.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span>        <span class="kr">const</span> <span class="nx">cosignatureTransaction</span> <span class="o">=</span> <span class="nx">CosignatureTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">transaction</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>                  <span class="kd">final</span> <span class="n">CosignatureTransaction</span> <span class="n">cosignatureTransaction</span> <span class="o">=</span> <span class="n">CosignatureTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">tx</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>        <span class="kr">const</span> <span class="nx">cosignatureTransaction</span> <span class="o">=</span> <span class="nx">CosignatureTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">transaction</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Sign the transaction using your account.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span>        <span class="kr">const</span> <span class="nx">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">signCosignatureTransaction</span><span class="p">(</span><span class="nx">cosignatureTransaction</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>                  <span class="kd">final</span> <span class="n">CosignatureSignedTransaction</span> <span class="n">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="na">signCosignatureTransaction</span><span class="o">(</span><span class="n">cosignatureTransaction</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>        <span class="kr">const</span> <span class="nx">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">signCosignatureTransaction</span><span class="p">(</span><span class="nx">cosignatureTransaction</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>And announce the <code class="docutils literal"><span class="pre">CosignatureSignedTransaction</span></code> to the network using the <code class="docutils literal"><span class="pre">TransactionHttp</span></code> repository.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span>        <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBondedCosignature</span><span class="p">(</span><span class="nx">cosignatureSignedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
    <span class="p">});</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>                  <span class="k">return</span> <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announceAggregateBondedCosignature</span><span class="o">(</span><span class="n">cosignatureSignedTransaction</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>        <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBondedCosignature</span><span class="p">(</span><span class="nx">cosignatureSignedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
    <span class="p">});</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="signing-announced-aggregate-bonded-transactions-automatically">
<span id="guide-signing-announced-aggregate-bonded-transactions-automatically"></span><h2>Signing announced aggregate bonded transactions automatically<a class="headerlink" href="#signing-announced-aggregate-bonded-transactions-automatically" title="Permalink to this headline">¶</a></h2>
<p>Following this guide, you will create an application to sign  <a class="reference internal" href="../concepts/transaction.html#aggregate-transaction"><span class="std std-ref">aggregate bonded transactions</span></a> automatically.</p>
<p>The app will be notified every time a new aggregate bonded transaction is sent to your account, sign the transaction and send it to the network.</p>
<div class="section" id="id17">
<h3>Prerequisites<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish <a class="reference internal" href="#guide-creating-an-escrow-with-aggregate-bonded-transaction"><span class="std std-ref">creating an escrow with aggregate bonded transaction guide</span></a></li>
<li>Received some aggregate bonded transaction</li>
<li>NEM2-SDK</li>
<li>A text editor or IDE</li>
<li>An account with XEM</li>
</ul>
</div>
<div class="section" id="id18">
<h3>Let’s get into some code<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>Create a new listener to get notified every time a new aggregate bonded transaction is sent to your account.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">Listener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Listener</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Open the connection. You only need to open the connection once and then connect to all desired channels.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="n">listener</span><span class="o">.</span><span class="na">open</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<p>Start listening for new transactions to cosign by your account. To do this, subscribe to the <code class="docutils literal"><span class="pre">aggregateBondedAdded</span></code> channel using your account’s address.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To sign automatically aggregate bonded transactions that should be signed by multisig cosignatories, refer to the multisig address instead. See <a class="reference internal" href="account.html#guide-get-multisig-account-info"><span class="std std-ref">how to get multisig accounts where an account is cosignatory</span></a>.</p>
</div>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span>    <span class="nx">listener</span><span class="p">.</span><span class="nx">aggregateBondedAdded</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">signedByAccount</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">aggregateTransaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">AggregateTransaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="na">aggregateBondedAdded</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getAddress</span><span class="o">()).</span><span class="na">take</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">transaction</span><span class="o">.</span><span class="na">signedByAccount</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">()))</span> <span class="o">{</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>    <span class="nx">listener</span><span class="p">.</span><span class="nx">aggregateBondedAdded</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">signedByAccount</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">aggregateTransaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<p>Now that you can get a new transaction, take the aggregate bonded transaction and create a <a class="reference internal" href="../concepts/transaction.html#cosignature-transaction"><span class="std std-ref">cosignature transaction</span></a> with it.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span>            <span class="kr">const</span> <span class="nx">cosignatureTransaction</span> <span class="o">=</span> <span class="nx">CosignatureTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>            <span class="kd">final</span> <span class="n">CosignatureTransaction</span> <span class="n">cosignatureTransaction</span> <span class="o">=</span> <span class="n">CosignatureTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">transaction</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>            <span class="kr">const</span> <span class="nx">cosignatureTransaction</span> <span class="o">=</span> <span class="nx">CosignatureTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Sign the transaction using your account.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span>            <span class="kr">const</span> <span class="nx">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">signCosignatureTransaction</span><span class="p">(</span><span class="nx">cosignatureTransaction</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>            <span class="kd">final</span> <span class="n">CosignatureSignedTransaction</span> <span class="n">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="na">signCosignatureTransaction</span><span class="o">(</span><span class="n">cosignatureTransaction</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>            <span class="kr">const</span> <span class="nx">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">signCosignatureTransaction</span><span class="p">(</span><span class="nx">cosignatureTransaction</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>And announce the <code class="docutils literal"><span class="pre">CosignatureSignedTransaction</span></code> to the network using the <code class="docutils literal"><span class="pre">TransactionHttp</span></code> repository.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span>            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBondedCosignature</span><span class="p">(</span><span class="nx">cosignatureSignedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>            <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announceAggregateBondedCosignature</span><span class="o">(</span><span class="n">cosignatureSignedTransaction</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBondedCosignature</span><span class="p">(</span><span class="nx">cosignatureSignedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id19">
<h3>What’s next?<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>In this guide, you have seen how to create an automatic signature for an account aggregate bonded transactions. Now that you know some general concepts, you could extend it by filtering transactions matching some constraints.</p>
<ul class="simple">
<li>Aggregate transactions with two inner transactions.</li>
<li>Two inner transactions must be transfer transactions.</li>
<li>The transaction sending funds must have yourself as the signer.</li>
<li>The transaction sending funds should have only one mosaic being this less than 100 XEM.</li>
</ul>
<p>Try it yourself! Here you have the implementation:</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">listener</span><span class="p">.</span><span class="nx">aggregateBondedAdded</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">innerTransactions</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">signedByAccount</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">validTransaction</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">innerTransactions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">)</span> <span class="o">||</span> <span class="nx">validTransaction</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">innerTransactions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">aggregateTransaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

            <span class="kr">const</span> <span class="nx">cosignatureTransaction</span> <span class="o">=</span> <span class="nx">CosignatureTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">signCosignatureTransaction</span><span class="p">(</span><span class="nx">cosignatureTransaction</span><span class="p">);</span>
            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBondedCosignature</span><span class="p">(</span><span class="nx">cosignatureSignedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">});</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">validTransaction</span><span class="p">(</span><span class="nx">transaction</span>: <span class="kt">Transaction</span><span class="p">,</span> <span class="nx">publicAccount</span>: <span class="kt">PublicAccount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">transaction</span> <span class="k">instanceof</span> <span class="nx">TransferTransaction</span> <span class="o">&amp;&amp;</span>
        <span class="nx">transaction</span><span class="p">.</span><span class="nx">signer</span><span class="o">!</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">publicAccount</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nx">transaction</span><span class="p">.</span><span class="nx">mosaics</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
        <span class="nx">transaction</span><span class="p">.</span><span class="nx">mosaics</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">MOSAIC_ID</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nx">transaction</span><span class="p">.</span><span class="nx">mosaics</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">amount</span><span class="p">.</span><span class="nx">compact</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span><span class="nx">amount</span><span class="p">.</span><span class="nx">compact</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="kd">final</span> <span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

        <span class="kd">final</span> <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="na">createFromPrivateKey</span><span class="o">(</span><span class="n">privateKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN_TEST</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">AccountHttp</span> <span class="n">accountHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AccountHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">Listener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Listener</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>

        <span class="n">listener</span><span class="o">.</span><span class="na">open</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">AggregateTransaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="na">aggregateBondedAdded</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getAddress</span><span class="o">())</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="n">tx</span><span class="o">.</span><span class="na">getInnerTransactions</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">tx</span><span class="o">.</span><span class="na">signedByAccount</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="n">validTransaction</span><span class="o">(</span><span class="n">tx</span><span class="o">.</span><span class="na">getInnerTransactions</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="n">account</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">())</span> <span class="o">||</span> <span class="n">validTransaction</span><span class="o">(</span><span class="n">tx</span><span class="o">.</span><span class="na">getInnerTransactions</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">account</span><span class="o">.</span><span class="na">getPublicAccount</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
                <span class="o">.</span><span class="na">toFuture</span><span class="o">()</span>
                <span class="o">.</span><span class="na">get</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">CosignatureTransaction</span> <span class="n">cosignatureTransaction</span> <span class="o">=</span> <span class="n">CosignatureTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">transaction</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">CosignatureSignedTransaction</span> <span class="n">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="na">signCosignatureTransaction</span><span class="o">(</span><span class="n">cosignatureTransaction</span><span class="o">);</span>

        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announceAggregateBondedCosignature</span><span class="o">(</span><span class="n">cosignatureSignedTransaction</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">validTransaction</span><span class="o">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="o">,</span> <span class="n">PublicAccount</span> <span class="n">publicAccount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getType</span><span class="o">()</span> <span class="o">==</span> <span class="n">TransactionType</span><span class="o">.</span><span class="na">TRANSFER</span> <span class="o">&amp;&amp;</span>
                <span class="n">transaction</span><span class="o">.</span><span class="na">getSigner</span><span class="o">().</span><span class="na">get</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">publicAccount</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                <span class="o">((</span><span class="n">TransferTransaction</span><span class="o">)</span><span class="n">transaction</span><span class="o">).</span><span class="na">getMosaics</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
                <span class="o">((</span><span class="n">TransferTransaction</span><span class="o">)</span><span class="n">transaction</span><span class="o">).</span><span class="na">getMosaics</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getId</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">XEM</span><span class="o">.</span><span class="na">MOSAICID</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                <span class="o">((</span><span class="n">TransferTransaction</span><span class="o">)</span> <span class="n">transaction</span><span class="o">).</span><span class="na">getMosaics</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getAmount</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">100</span><span class="o">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN_TEST</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">listener</span><span class="p">.</span><span class="nx">aggregateBondedAdded</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">innerTransactions</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">signedByAccount</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">validTransaction</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">innerTransactions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">)</span> <span class="o">||</span> <span class="nx">validTransaction</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">innerTransactions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">account</span><span class="p">.</span><span class="nx">publicAccount</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">aggregateTransaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

            <span class="kr">const</span> <span class="nx">cosignatureTransaction</span> <span class="o">=</span> <span class="nx">CosignatureTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">aggregateTransaction</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">cosignatureSignedTransaction</span> <span class="o">=</span> <span class="nx">account</span><span class="p">.</span><span class="nx">signCosignatureTransaction</span><span class="p">(</span><span class="nx">cosignatureTransaction</span><span class="p">);</span>
            <span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announceAggregateBondedCosignature</span><span class="p">(</span><span class="nx">cosignatureSignedTransaction</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
        <span class="p">});</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">validTransaction</span><span class="p">(</span><span class="nx">transaction</span><span class="p">,</span> <span class="nx">publicAccount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">transaction</span> <span class="k">instanceof</span> <span class="nx">TransferTransaction</span> <span class="o">&amp;&amp;</span>
        <span class="nx">transaction</span><span class="p">.</span><span class="nx">signer</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">publicAccount</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nx">transaction</span><span class="p">.</span><span class="nx">mosaics</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
        <span class="nx">transaction</span><span class="p">.</span><span class="nx">mosaics</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">XEM</span><span class="p">.</span><span class="nx">MOSAIC_ID</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nx">transaction</span><span class="p">.</span><span class="nx">mosaics</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">amount</span><span class="p">.</span><span class="nx">compact</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">XEM</span><span class="p">.</span><span class="nx">createRelative</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span><span class="nx">amount</span><span class="p">.</span><span class="nx">compact</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-secret-lock-for-atomic-cross-chain-swap-transactions">
<span id="guide-using-secret-lock-for-atomic-cross-chain-swap"></span><h2>Using secret lock for atomic cross-chain swap transactions<a class="headerlink" href="#using-secret-lock-for-atomic-cross-chain-swap-transactions" title="Permalink to this headline">¶</a></h2>
<p>The goal of this guide is to show you how to exchange tokens between different blockchains atomically using <a class="reference internal" href="../concepts/transaction.html#secret-lock-transaction"><span class="std std-ref">secret lock</span></a> and <a class="reference internal" href="../concepts/transaction.html#secret-proof-transaction"><span class="std std-ref">secret proof transactions</span></a>.</p>
<div class="section" id="id20">
<h3>Background<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>Alice and Bob want to change 10 alice:token per 10 bob:token. The problem is that they are not in the same blockchain: Alice uses NEM public network, whereas Bob is using MIJIN private network.</p>
<p>One non-atomic solution could be:</p>
<ol class="arabic simple">
<li>Alice sends to Bob 10 alice:token in PUBLIC chain</li>
<li>Bob receives the transaction</li>
<li>Bob sends to Alice 10 bob:token in PRIVATE chain</li>
<li>Alice receives the transaction</li>
</ol>
<p>But they don’t trust each other that much. Ideally, they want to exchange their tokens between different blockchains atomically.</p>
<p>Following this guide, you will swap transactions between different blockchain platforms atomically using secret lock transaction.</p>
<div class="figure align-center" id="id31">
<a class="reference internal image-reference" href="../_images/guides-transactions-atomic-cross-chain-swap1.png"><img alt="../_images/guides-transactions-atomic-cross-chain-swap1.png" src="../_images/guides-transactions-atomic-cross-chain-swap1.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Atomic cross-chain trading between public and private network</span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Mijin and NEM share SDK. The example will work with other blockchain platforms if implements Secret Lock / Secret Proof transactions mechanism.</p>
</div>
</div>
<div class="section" id="id21">
<h3>Prerequisites<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish <a class="reference internal" href="#guide-creating-an-escrow-with-aggregate-bonded-transaction"><span class="std std-ref">creating an escrow with aggregate bonded transaction guide</span></a></li>
<li>NEM2-SDK</li>
<li>A text editor or IDE</li>
</ul>
</div>
<div class="section" id="id22">
<h3>Let’s get into some code?<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>Alice picks a random number, which we call proof, and applies a sha512 hash, obtaining the secret.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Alice is a PUBLIC net user</span>
<span class="kr">const</span> <span class="nx">alicePrivateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ALICE_PRIVATE_KEY</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">aliceAccount</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">alicePrivateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MAIN_NET</span><span class="p">);</span>

<span class="c1">// Alice picks a random number and hashes it.</span>
<span class="kr">const</span> <span class="nx">random</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">randomBytes</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">sha3_512</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">random</span><span class="p">).</span><span class="nx">hex</span><span class="p">().</span><span class="nx">toUpperCase</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">proof</span> <span class="o">=</span> <span class="nx">random</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Alice is a PUBLIC net user</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">alicePrivateKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="kd">final</span> <span class="n">Account</span> <span class="n">aliceAccount</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="na">createFromPrivateKey</span><span class="o">(</span><span class="n">alicePrivateKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MAIN_NET</span><span class="o">);</span>

        <span class="c1">// Alice picks a random number and hashes it.</span>
        <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">secretBytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">20</span><span class="o">];</span>
        <span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextBytes</span><span class="o">(</span><span class="n">secretBytes</span><span class="o">);</span>
        <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Hashes</span><span class="o">.</span><span class="na">sha3_512</span><span class="o">(</span><span class="n">secretBytes</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">secret</span> <span class="o">=</span> <span class="n">Hex</span><span class="o">.</span><span class="na">encodeHexString</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">proof</span> <span class="o">=</span> <span class="n">Hex</span><span class="o">.</span><span class="na">encodeHexString</span><span class="o">(</span><span class="n">secretBytes</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Alice is a PUBLIC net user</span>
<span class="kr">const</span> <span class="nx">alicePrivateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ALICE_PRIVATE_KEY</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">aliceAccount</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">alicePrivateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MAIN_NET</span><span class="p">);</span>

<span class="c1">// Alice picks a random number and hashes it.</span>
<span class="kr">const</span> <span class="nx">random</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">randomBytes</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">sha3_512</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">random</span><span class="p">).</span><span class="nx">hex</span><span class="p">().</span><span class="nx">toUpperCase</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">proof</span> <span class="o">=</span> <span class="nx">random</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Now, Alice creates a secret lock transaction, which contains:</p>
<ul class="simple">
<li>The mosaic and amount to be sent: 10 alice:token</li>
<li>A recipient address: Bob’s address in public chain</li>
<li>The secret that should be achieved in to unlock the funds.</li>
<li>The amount of time while funds can be unlocked: 96h</li>
</ul>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Alice creates creates TX1 SecretLockTransaction{ H(x), B, MosaicId, Amount, valid for 96h }</span>
<span class="kr">const</span> <span class="nx">tx1</span> <span class="o">=</span> <span class="nx">SecretLockTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">Mosaic</span><span class="p">(</span><span class="k">new</span> <span class="nx">MosaicId</span><span class="p">(</span><span class="s1">&#39;alice:token&#39;</span><span class="p">),</span> <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">96</span><span class="o">*</span><span class="mi">60</span><span class="p">),</span> <span class="c1">//assume one block per minute</span>
    <span class="nx">HashType</span><span class="p">.</span><span class="nx">SHA3_512</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">,</span>
    <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="s1">&#39;SDG4WG-FS7EQJ-KFQKXM-4IUCQG-PXUW5H-DJVIJB-OXJG&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MAIN_NET</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Alice creates creates TX1 SecretLockTransaction{ H(x), B, MosaicId, Amount, valid for 96h }</span>
        <span class="kd">final</span> <span class="n">SecretLockTransaction</span> <span class="n">tx1</span> <span class="o">=</span> <span class="n">SecretLockTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">Deadline</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Mosaic</span><span class="o">(</span><span class="k">new</span> <span class="n">MosaicId</span><span class="o">(</span><span class="s">&quot;alice:token&quot;</span><span class="o">),</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">)),</span>
                <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">96</span> <span class="o">*</span> <span class="mi">60</span><span class="o">),</span> <span class="c1">//assume one block per minute</span>
                <span class="n">HashType</span><span class="o">.</span><span class="na">SHA3_512</span><span class="o">,</span>
                <span class="n">secret</span><span class="o">,</span>
                <span class="n">Address</span><span class="o">.</span><span class="na">createFromRawAddress</span><span class="o">(</span><span class="s">&quot;NDG4WG-FS7EQJ-KFQKXM-4IUCQG-PXUW5H-DJVIJB-OXJG&quot;</span><span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MAIN_NET</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Alice creates creates TX1 SecretLockTransaction{ H(x), B, MosaicId, Amount, valid for 96h }</span>
<span class="kr">const</span> <span class="nx">tx1</span> <span class="o">=</span> <span class="nx">SecretLockTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">Mosaic</span><span class="p">(</span><span class="k">new</span> <span class="nx">MosaicId</span><span class="p">(</span><span class="s1">&#39;alice:token&#39;</span><span class="p">),</span> <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">96</span><span class="o">*</span><span class="mi">60</span><span class="p">),</span> <span class="c1">//assume one block per minute</span>
    <span class="nx">HashType</span><span class="p">.</span><span class="nx">SHA3_512</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">,</span>
    <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="s1">&#39;SDG4WG-FS7EQJ-KFQKXM-4IUCQG-PXUW5H-DJVIJB-OXJG&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MAIN_NET</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Alice signs and announces TX1 to NEM network.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Alice sends TX1 to network (PUBLIC)</span>
<span class="kr">const</span> <span class="nx">tx1Signed</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tx1</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>
<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">tx1Signed</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Alice sends TX1 to network (PUBLIC)</span>
        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">tx1Signed</span> <span class="o">=</span> <span class="n">aliceAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">tx1</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">TransactionHttp</span> <span class="n">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionHttp</span><span class="o">(</span><span class="s">&quot;http://localhost:3000&quot;</span><span class="o">);</span>
        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">tx1Signed</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Alice sends TX1 to network (PUBLIC)</span>
<span class="kr">const</span> <span class="nx">tx1Signed</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tx1</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">transactionHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TransactionHttp</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">);</span>
<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">tx1Signed</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>Alice can tell Bob the secret, or he can retrieve it directly from the recently announced transaction.</p>
<p>Bob creates a secret lock transaction TX2, which contains:</p>
<ul class="simple">
<li>The mosaic and amount to be sent: 10 bob:token</li>
<li>A recipient address: Alice’s address in private chain</li>
<li>The secret that should be achieved to unlock the funds.</li>
<li>The amount of time while funds can be unlocked: 84h</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The amount of time while funds can be unlocked should be smaller time frame than TX1’s. Alice knows the secret, so Bob must be sure, he’ll have some time left after Alice will release the secret.</p>
</div>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Bob is a PRIVATE network user</span>
<span class="kr">const</span> <span class="nx">bobPrivateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BOB_PRIVATE_KEY</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">bobAccount</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">bobPrivateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN</span><span class="p">);</span>


<span class="c1">// B creates TX2 SecretLockTransaction{ H(x), A, MosaicId, Amount, valid for 84h }</span>
<span class="kr">const</span> <span class="nx">tx2</span> <span class="o">=</span> <span class="nx">SecretLockTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">Mosaic</span><span class="p">(</span><span class="k">new</span> <span class="nx">MosaicId</span><span class="p">(</span><span class="s1">&#39;bob:token&#39;</span><span class="p">),</span> <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">84</span><span class="o">*</span><span class="mi">60</span><span class="p">),</span> <span class="c1">//assume one block per minute</span>
    <span class="nx">HashType</span><span class="p">.</span><span class="nx">SHA3_512</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">,</span>
    <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="s1">&#39;SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Bob is a PRIVATE network user</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">bobPrivateKey</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="kd">final</span> <span class="n">Account</span> <span class="n">bobAccount</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="na">createFromPrivateKey</span><span class="o">(</span><span class="n">bobPrivateKey</span><span class="o">,</span> <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN</span><span class="o">);</span>

        <span class="c1">// B creates TX2 SecretLockTransaction{ H(x), A, MosaicId, Amount, valid for 84h }</span>
        <span class="kd">final</span> <span class="n">SecretLockTransaction</span> <span class="n">tx2</span> <span class="o">=</span> <span class="n">SecretLockTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">Deadline</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Mosaic</span><span class="o">(</span><span class="k">new</span> <span class="n">MosaicId</span><span class="o">(</span><span class="s">&quot;bob:token&quot;</span><span class="o">),</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span><span class="o">)),</span>
                <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">84</span> <span class="o">*</span> <span class="mi">60</span><span class="o">),</span> <span class="c1">//assume one block per minute</span>
                <span class="n">HashType</span><span class="o">.</span><span class="na">SHA3_512</span><span class="o">,</span>
                <span class="n">secret</span><span class="o">,</span>
                <span class="n">Address</span><span class="o">.</span><span class="na">createFromRawAddress</span><span class="o">(</span><span class="s">&quot;MD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&quot;</span><span class="o">),</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN</span>
        <span class="o">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Bob is a PRIVATE network user</span>
<span class="kr">const</span> <span class="nx">bobPrivateKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BOB_PRIVATE_KEY</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">bobAccount</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">createFromPrivateKey</span><span class="p">(</span><span class="nx">bobPrivateKey</span><span class="p">,</span> <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN</span><span class="p">);</span>


<span class="c1">// B creates TX2 SecretLockTransaction{ H(x), A, MosaicId, Amount, valid for 84h }</span>
<span class="kr">const</span> <span class="nx">tx2</span> <span class="o">=</span> <span class="nx">SecretLockTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">Mosaic</span><span class="p">(</span><span class="k">new</span> <span class="nx">MosaicId</span><span class="p">(</span><span class="s1">&#39;bob:token&#39;</span><span class="p">),</span> <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
    <span class="nx">UInt64</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">84</span><span class="o">*</span><span class="mi">60</span><span class="p">),</span> <span class="c1">//assume one block per minute</span>
    <span class="nx">HashType</span><span class="p">.</span><span class="nx">SHA3_512</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">,</span>
    <span class="nx">Address</span><span class="p">.</span><span class="nx">createFromRawAddress</span><span class="p">(</span><span class="s1">&#39;SD5DT3-CH4BLA-BL5HIM-EKP2TA-PUKF4N-Y3L5HR-IR54&#39;</span><span class="p">),</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Once signed, Bob announces TX2 to MIJIN network.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Bob sends TX2 to network (PRIVATE)</span>
<span class="kr">const</span> <span class="nx">tx2Signed</span> <span class="o">=</span> <span class="nx">bobAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tx2</span><span class="p">);</span>
<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">tx2Signed</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Bob sends TX2 to network (PRIVATE)</span>
        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">tx2Signed</span> <span class="o">=</span> <span class="n">bobAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">tx2</span><span class="o">);</span>
        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">tx2Signed</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Bob sends TX2 to network (PRIVATE)</span>
<span class="kr">const</span> <span class="nx">tx2Signed</span> <span class="o">=</span> <span class="nx">bobAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tx2</span><span class="p">);</span>
<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">tx2Signed</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>Now, Alice can announce a secret proof transaction in MIJIN network, selecting encrypting algorithm, the original proof and secret used.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Alice waits until Txs are confirmed</span>
<span class="c1">// Alice spends TX2 transaction by sending SecretProofTransaction (in PRIVATE network)</span>
<span class="kr">const</span> <span class="nx">tx3</span> <span class="o">=</span> <span class="nx">SecretProofTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">HashType</span><span class="p">.</span><span class="nx">SHA3_512</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">,</span>
    <span class="nx">proof</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">tx3Signed</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tx3</span><span class="p">);</span>
<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">tx3Signed</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Alice spends TX2 transaction by sending SecretProofTransaction (in PRIVATE network)</span>
        <span class="n">SecretProofTransaction</span> <span class="n">tx3</span> <span class="o">=</span> <span class="n">SecretProofTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">Deadline</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">HashType</span><span class="o">.</span><span class="na">SHA3_512</span><span class="o">,</span>
                <span class="n">secret</span><span class="o">,</span>
                <span class="n">proof</span><span class="o">,</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MIJIN</span>
        <span class="o">);</span>

        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">tx3Signed</span> <span class="o">=</span> <span class="n">aliceAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">tx3</span><span class="o">);</span>
        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">tx3Signed</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Alice waits until Txs are confirmed</span>
<span class="c1">// Alice spends TX2 transaction by sending SecretProofTransaction (in PRIVATE network)</span>
<span class="kr">const</span> <span class="nx">tx3</span> <span class="o">=</span> <span class="nx">SecretProofTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">HashType</span><span class="p">.</span><span class="nx">SHA3_512</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">,</span>
    <span class="nx">proof</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MIJIN</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">tx3Signed</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tx3</span><span class="p">);</span>
<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">tx3Signed</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>If all goes well, Alice unlocks TX2 funds, and the proof is revealed. Bob does the same by announcing a secret proof transaction TX4  in NEM blockchain.</p>
<div class="example-code container">
<div class="highlight-typescript"><div class="highlight"><pre><span></span><span class="c1">// Bob spends TX1 transaction by sending SecretProofTransaction (in PUBLIC network)</span>
<span class="kr">const</span> <span class="nx">tx4</span> <span class="o">=</span> <span class="nx">SecretProofTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">HashType</span><span class="p">.</span><span class="nx">SHA3_512</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">,</span>
    <span class="nx">proof</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MAIN_NET</span>
<span class="p">);</span>
<span class="kr">const</span> <span class="nx">tx4Signed</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tx4</span><span class="p">);</span>

<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">tx4Signed</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span>        <span class="c1">// Bob spends TX1 transaction by sending SecretProofTransaction (in PUBLIC network)</span>
        <span class="n">SecretProofTransaction</span> <span class="n">tx4</span> <span class="o">=</span> <span class="n">SecretProofTransaction</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">Deadline</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">HOURS</span><span class="o">),</span>
                <span class="n">HashType</span><span class="o">.</span><span class="na">SHA3_512</span><span class="o">,</span>
                <span class="n">secret</span><span class="o">,</span>
                <span class="n">proof</span><span class="o">,</span>
                <span class="n">NetworkType</span><span class="o">.</span><span class="na">MAIN_NET</span>
        <span class="o">);</span>


        <span class="kd">final</span> <span class="n">SignedTransaction</span> <span class="n">tx4Signed</span> <span class="o">=</span> <span class="n">aliceAccount</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">tx4</span><span class="o">);</span>
        <span class="n">transactionHttp</span><span class="o">.</span><span class="na">announce</span><span class="o">(</span><span class="n">tx4Signed</span><span class="o">).</span><span class="na">toFuture</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Bob spends TX1 transaction by sending SecretProofTransaction (in PUBLIC network)</span>
<span class="kr">const</span> <span class="nx">tx4</span> <span class="o">=</span> <span class="nx">SecretProofTransaction</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
    <span class="nx">Deadline</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
    <span class="nx">HashType</span><span class="p">.</span><span class="nx">SHA3_512</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">,</span>
    <span class="nx">proof</span><span class="p">,</span>
    <span class="nx">NetworkType</span><span class="p">.</span><span class="nx">MAIN_NET</span>
<span class="p">);</span>
<span class="kr">const</span> <span class="nx">tx4Signed</span> <span class="o">=</span> <span class="nx">aliceAccount</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tx4</span><span class="p">);</span>

<span class="nx">transactionHttp</span><span class="p">.</span><span class="nx">announce</span><span class="p">(</span><span class="nx">tx4Signed</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>At that moment, Bob unlocks TX1 funds, and the atomic cross-chain swap concludes.</p>
</div>
<div class="section" id="is-it-atomic">
<h3>Is it atomic?<a class="headerlink" href="#is-it-atomic" title="Permalink to this headline">¶</a></h3>
<p>Consider the following scenarios:</p>
<ol class="upperalpha simple">
<li>Bob doesn’t want to announce Tx2. Alice will receive his funds back after 94 hours.</li>
<li>Alice does not want to swap tokens by signing Tx3. Bob will receive his refund after 84h. Alice will unlock as well her funds after 94 hours.</li>
<li>Alice signs and announces Tx3, receiving Bob’s funds. Bob will have time to sign Tx4, as Tx1 validity is longer than Tx2.</li>
</ol>
<p>The process is atomic but should be completed with lots of time before the deadlines.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cli/overview.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mosaic.html" class="btn btn-neutral" title="Interacting with mosaics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, NEM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'Master',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/examplecode.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>